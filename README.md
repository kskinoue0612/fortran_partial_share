# FORTRAN プログラムの部分ソースコードの共有

## はじめに

この文書では、以下のようなケースに対応した形で、プログラムのソースコードの一部を共有する
方法について説明します。

* 相手に自由に改変してほしい関数のソースコードを共有する。
* 上記関数を呼び出すメインプログラムなど、その他のソースコードは共有しない。
* 共有した相手が、関数のソースコードを改変した上で、自由にコンパイルして実行できる。

## 前提条件

先に、Intel One API をインストールし、Intel FORTRAN コンパイラが実行可能な環境を作っておきます。
手順の例は以下をご参照下さい。

https://qiita.com/Kazutake/items/a069f86d21ca43b6c153

## 手順1: ソースコードの用意

プログラムのソースコード一式を用意します。
このサンプルでは、 src 以下にソースコード一式を格納してあります。
ファイルは以下の通りです。

* main.f90: PROGRAM が定義されたソースコード
* func_secret.f90: 共有したくない関数の定義が格納されたソースコード
* func_public.f90: 共有し、相手に改変させたい関数の定義が格納されたソースコード
* make_dist.bat 上記3つのファイルから、相手に共有するためのファイル一式を作るためのバッチファイル

make_dist.bat を実行すると、以下の処理が行われます。
1. 全ソースコードがコンパイルされ、 *.obj, *.mod ファイルを作成します。
2. 上の処理でできた *.obj, *.mod ファイルを dist フィルダにコピーします。
3. 共有したいソースである func_public.f90 を dist フォルダにコピーします。

## 手順2: ファイルの共有

上記処理でできた、 dist フォルダ以下のファイル一式を、zip ファイルなどに格納して
共有したい相手に渡します。共有されるファイルには、秘匿したいプログラムのソースコードは含まれていません。

## 手順3: ソースコードの変更とビルド

**この手順は、ファイルを共有した相手が行います。**

受領した dist フォルダ内のファイルについて以下を行います。

1. func_public.f90 の中の関数 do_something の中身を改変します。**関数の名前や引数の型を変えることはできません**。
2. build.bat を実行します。

上記を実行すると、share_test.ext ができ、実行できるようになります。

# まとめ

プログラムについて、一部のソースコードのみ相手が編集できるようにし、それ以外を秘匿した形で共有し、プログラムをビルド、実行できるようにする手順を紹介しました。

秘匿したいソースコードについては共有せず、ソースコードをコンパイルしてできた *.obj, *.mod のみを共有する点がポイントです。
